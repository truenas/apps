# ## Usage
#
# name: Post GitHub Discussion comment to Slack
#
# on:
#   discussion_comment:
#     types: [created]
#
# jobs:
#   discussion_commented:
#     if: github.event.discussion && github.event.comment
#     uses: route06/actions/.github/workflows/gh_discussion_comment_to_slack.yml@v2
#     secrets:
#       slack-webhook-url: ${{ secrets.SLACK_XXX_WEBHOOK_URL }} # Set this secret
#
# Event payload information
# https://docs.github.com/en/webhooks/webhook-events-and-payloads?actionType=created#discussion

name: Send GitHub Action data to a Slack workflow

on:
  discussion:
    types: [created]
    secrets:
      SLACK_WEBHOOK_URL:
        required: true
       
jobs:
  run:
    name: Share recent changes with a channel
    runs-on: ubuntu-latest
    steps:
      - name: Send discussion created announcement
        uses: slackapi/slack-github-action@v2.0.0
        with:
            webhook: ${{ secrets.SLACK_WEBHOOK_URL }}
            webhook-type: incoming-webhook
            payload: |
              text: "*GitHub Discussion Created*: ${{ github.event.discussion.title }}\n${{ github.event.discussion.html_url }}"
              blocks:
                  - type: "section"
              text:
                  type: "mrkdwn"
                  text: "GitHub Action build result: ${{ github.event.discussion.title }}\n${{ github.event.discussion.html_url }}"

