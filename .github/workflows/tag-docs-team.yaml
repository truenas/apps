name: Notify docs team about train changes

on:
  pull_request: {}

env:
  accounts_to_notify: |
    - @stavros-k

jobs:
  notify-teams:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get changed files
        id: changed-files
        uses: tj-actions/changed-files@v42
        with:
          files_yaml: |
            enterprise:
              - ix-dev/enterprise/**
            stable:
              - ix-dev/stable/**
            test:
              - ix-dev/test/**

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Generate message
        id: message
        if: ${{
          steps.changed-files.outputs.enterprise_added_files != '' ||
          steps.changed-files.outputs.enterprise_modified_files != '' ||
          steps.changed-files.outputs.stable_added_files != '' ||
          steps.changed-files.outputs.stable_modified_files != '' ||
          steps.changed-files.outputs.test_added_files != '' ||
          steps.changed-files.outputs.test_modified_files != ''
          }}
        run: |
          {
            python3 .github/scripts/message.py "Enterprise" "added" "${{ steps.changed-files.outputs.enterprise_added_files }}" || true
            python3 .github/scripts/message.py "Enterprise" "modified" "${{ steps.changed-files.outputs.enterprise_modified_files }}" ||
            python3 .github/scripts/message.py "Stable" "added" "${{ steps.changed-files.outputs.stable_added_files }}" || true
            python3 .github/scripts/message.py "Stable" "modified" "${{ steps.changed-files.outputs.stable_modified_files }}" || true
            python3 .github/scripts/message.py "Test" "added" "${{ steps.changed-files.outputs.test_added_files }}" || true
            python3 .github/scripts/message.py "Test" "modified" "${{ steps.changed-files.outputs.test_modified_files }}" || true
          } > message.txt

          cat message.txt
          echo "message='$(cat message.txt)'" >> $GITHUB_OUTPUT

      - name: Comment PR
        uses: thollander/actions-comment-pull-request@v3
        if: ${{ steps.message.outputs.message != '' }}
        with:
          comment-tag: docs-team-comment
          message: |
            ${{ steps.message.outputs.message }}

            Notifying the following about changes to the trains:
            ${{ env.accounts_to_notify }}
