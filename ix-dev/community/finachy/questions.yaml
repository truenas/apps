groups:
  - name: Finachy Config
    description: Finachy Application Configuration
  - name: Network
    description: Network Configuration
  - name: Storage
    description: Storage Configuration
  - name: Resources
    description: Resource Configuration

questions:
  - variable: finachy
    label: ""
    group: Finachy Config
    schema:
      type: dict
      attrs:
        - variable: secret_key_base
          label: Secret Key Base
          description: "Secret key for verifying the integrity of signed cookies. Use `openssl rand -hex 64` to generate one."
          schema:
            type: string
            required: true
            private: true
        - variable: postgres_password
          label: Database Password
          description: Password for the PostgreSQL database.
          schema:
            type: string
            required: true
            private: true
        - variable: redis_password
          label: Redis Password
          description: Password for the Redis server.
          schema:
            type: string
            required: true
            private: true
        - variable: additional_envs
          label: Additional Environment Variables
          schema:
            type: list
            default: []
            items:
              - variable: env
                label: Environment Variable
                schema:
                  type: dict
                  attrs:
                    - variable: name
                      label: Name
                      schema:
                        type: string
                        required: true
                    - variable: value
                      label: Value
                      schema:
                        type: string
                        required: true

  - variable: run_as
    label: ""
    group: Finachy Config
    schema:
      type: dict
      attrs:
        - variable: user
          label: User ID
          schema:
            type: int
            default: 1000
        - variable: group
          label: Group ID
          schema:
            type: int
            default: 1000

  - variable: network
    label: ""
    group: Network
    schema:
      type: dict
      attrs:
        - variable: web_port
          label: Web Port
          description: The port to access the Finachy web interface.
          schema:
            type: dict
            attrs:
              - variable: port
                label: Port
                schema:
                  type: int
                  default: 3000
                  required: true
                  min: 1024
                  max: 65535

  - variable: storage
    label: ""
    group: Storage
    schema:
      type: dict
      attrs:
        - variable: app_storage
          label: App Storage
          description: Persistent storage for uploads and other application data.
          schema:
            type: dict
            attrs:
              - variable: type
                label: Type
                schema:
                  type: string
                  default: ix_volume
                  enum:
                    - value: ix_volume
                      description: "TrueNAS Dataset"
                    - value: host_path
                      description: "Host Path"
              - variable: ix_volume_config
                label: Dataset Config
                schema:
                  type: dict
                  show_if: [["type", "=", "ix_volume"]]
                  attrs:
                    - variable: dataset_name
                      label: Dataset Name
                      schema:
                        type: string
                        required: true
              - variable: host_path_config
                label: Host Path Config
                schema:
                  type: dict
                  show_if: [["type", "=", "host_path"]]
                  attrs:
                    - variable: path
                      label: Host Path
                      schema:
                        type: hostpath
                        required: true
        - variable: postgres_data
          label: Postgres Data
          description: Persistent storage for the database.
          schema:
             type: dict
             attrs:
              - variable: type
                label: Type
                schema:
                  type: string
                  default: ix_volume
                  enum:
                     - value: ix_volume
                       description: TrueNAS Dataset
                     - value: host_path
                       description: Host Path
              - variable: ix_volume_config
                label: Dataset Config
                schema:
                   type: dict
                   show_if: [["type", "=", "ix_volume"]]
                   attrs:
                     - variable: dataset_name
                       label: Dataset Name
                       schema: 
                         type: string
                         required: true
              - variable: host_path_config
                label: Host Path Config
                schema:
                   type: dict
                   show_if: [["type", "=", "host_path"]]
                   attrs:
                     - variable: path
                       label: Host Path
                       schema:
                         type: hostpath
                         required: true
        - variable: redis_data
          label: Redis Data
          description: Persistent storage for Redis.
          schema:
             type: dict
             attrs:
              - variable: type
                label: Type
                schema:
                  type: string
                  default: ix_volume
                  enum:
                     - value: ix_volume
                       description: TrueNAS Dataset
                     - value: host_path
                       description: Host Path
              - variable: ix_volume_config
                label: Dataset Config
                schema:
                   type: dict
                   show_if: [["type", "=", "ix_volume"]]
                   attrs:
                     - variable: dataset_name
                       label: Dataset Name
                       schema: 
                         type: string
                         required: true
              - variable: host_path_config
                label: Host Path Config
                schema:
                   type: dict
                   show_if: [["type", "=", "host_path"]]
                   attrs:
                     - variable: path
                       label: Host Path
                       schema:
                         type: hostpath
                         required: true
