groups:
  - name: Node Exporter Configuration
    description: Configure Node Exporter
  - name: User and Group Configuration
    description: Configure User and Group for Node Exporter
  - name: Network Configuration
    description: Configure Network for Node Exporter
  - name: Storage Configuration
    description: Configure Storage for Node Exporter
  - name: Resources Configuration
    description: Configure Resources for Node Exporter

questions:
  - variable: TZ
    group: Node Exporter Configuration
    label: Timezone
    schema:
      type: string
      default: Etc/UTC
      required: true
      $ref:
        - definitions/timezone

  - variable: node_exporter
    group: Node Exporter Configuration
    label: Node Exporter Settings
    schema:
      type: dict
      attrs:
        - variable: collector_mount_points_exclude
          label: Exclude Mount Points
          description: Regex of mount points to exclude from the filesystem collector.
          schema:
            type: string
            default: "^/(sys|proc|dev|host|etc)($|/)"
        - variable: additional_args
          label: Additional Arguments
          schema:
            type: list
            default: []
            items:
              - variable: arg
                label: Argument
                schema:
                  type: string
                  required: true

  - variable: run_as
    group: User and Group Configuration
    label: User and Group Configuration
    schema:
      type: dict
      attrs:
        - variable: user
          label: UserID
          schema:
            type: int
            default: 568
            required: true
        - variable: group
          label: GroupID
          schema:
            type: int
            default: 568
            required: true

  - variable: network
    group: Network Configuration
    label: Network Configuration
    schema:
      type: dict
      attrs:
        - variable: host_network
          label: Host Network
          description: |
            Use the host network stack.</br>
            Note: This will disable the port configuration below and the application will bind directly to the host port.
          schema:
            type: boolean
            default: true
        - variable: web_port
          label: Web Port
          schema:
            type: dict
            show_if: [["host_network", "=", false]]
            attrs:
              - variable: bind_mode
                label: Port Bind Mode
                description: |
                  The port bind mode.</br>
                  - Publish: The port will be published on the host for external access.</br>
                  - Expose: The port will be exposed for inter-container communication.</br>
                  - None: The port will not be exposed or published.</br>
                  Note: If the Dockerfile defines an EXPOSE directive,
                  the port will still be exposed for inter-container communication regardless of this setting.
                schema:
                  type: string
                  default: "published"
                  enum:
                    - value: "published"
                      description: Publish port on the host for external access
                    - value: "exposed"
                      description: Expose port for inter-container communication
                    - value: ""
                      description: None
              - variable: port_number
                label: Port Number
                schema:
                  type: int
                  default: 9100
                  min: 1
                  max: 65535
                  required: true
              - variable: host_ips
                label: Host IPs
                description: IPs on the host to bind this port
                schema:
                  type: list
                  show_if: [["bind_mode", "=", "published"]]
                  default: []
                  items:
                    - variable: ip
                      label: IP
                      schema:
                        type: string
                        required: true

  - variable: storage
    group: Storage Configuration
    label: Storage Configuration
    schema:
      type: dict
      attrs:
        - variable: additional_storage
          label: Additional Storage
          schema:
            type: list
            default: []
            items:
              - variable: storage
                label: Storage
                schema:
                  type: dict
                  attrs:
                    - variable: mount_path
                      label: Mount Path
                      schema:
                        type: string
                        required: true
                    - variable: type
                      label: Type
                      schema:
                        type: string
                        default: host_path
                        enum:
                          - value: host_path
                            description: Host Path
                    - variable: host_path_config
                      label: Host Path Configuration
                      schema:
                        type: dict
                        attrs:
                          - variable: path
                            label: Host Path
                            schema:
                              type: string
                              required: true
                    - variable: read_only
                      label: Read Only
                      schema:
                        type: boolean
                        default: false

  - variable: resources
    group: Resources Configuration
    label: Resources Configuration
    schema:
      type: dict
      attrs:
        - variable: limits
          label: Limits
          schema:
            type: dict
            attrs:
              - variable: cpus
                label: CPUs
                schema:
                  type: float
                  default: 1.0
                  required: true
              - variable: memory
                label: Memory (MB)
                schema:
                  type: int
                  default: 512
                  required: true
